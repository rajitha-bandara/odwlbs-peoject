/*1337203504,176832697*/

if (window.CavalryLogger) { CavalryLogger.start_js(["EXBNI"]); }

__d("legacy:placeholder-form-listener",["PlaceholderListener"],function(a,b,c,d){b('PlaceholderListener');},3);
var PYMKMegaphoneChaining={init:function(a,b,c,d,e){this.root=a;this.units=[];this.unit_ids=[];this._addRow($(a));this.inst=b;this.loc=c;this.hf=d;this.ex=e;Arbiter.subscribe(FriendRequestMessage.SENT,this._onAddFriend.bind(this));},_addRow:function(a){var b=DOM.scry(a,'.friendBrowserUnit');for(var c=0;c<b.length;c++)this._addUnit(b[c]);},_addUnit:function(a){var b=DOM.find(a,'input.friendBrowserID');this.units[b.value]=a;this.unit_ids.push(parseInt(b.value,10));DOM.scry(a,'.closeButtonContainer').forEach(function(d){Event.listen(d,'click',this._onDiscard.bind(this,b.value));});var c=DOM.find(a,'.FriendLink');Event.listen(c,'click',function(){var d=DOM.find(a,'.photoContainer');CSS.removeClass(d,'discardable');});},_onAddFriend:function(a,b){var c=b.uid,d=this.units[c];if(!d)return;this._fetchNext(c,this._onAddFriendCallback.bind(this,c));},_onDiscard:function(a,event){var b=this.units[a];if(!b)return;event.preventDefault();Event.stop(event);this._fetchNext(a,this._onDiscardCallback.bind(this,b),{h:1});this._fadeOut(a);},_addNext:function(a,b,c){var d=this.units[a],e=DOM.insertAfter(d,b)[0];CSS.hide(e);this._fadeOut(a,(function(){this._addUnit(e);DOM.remove(d);CSS.show(e);c&&CSS.show(c);}).bind(this));},_onDiscardCallback:function(a,b){var c=b.getPayload(),d=c&&c.next,e=c&&c.ex;if(d){var f=DOM.insertAfter(a,d)[0];this._addUnit(f);}if(e&&this.ex)this._addExtra(e);if(d){DOM.remove(a);}else{var g=a.offsetWidth,h=$N('td',{"class":"gridUnitPlaceholder phs"});g&&h.setAttribute('width',g+"px");a.parentNode.parentNode.appendChild(h);DOM.remove(a.parentNode);}},_fetchNext:function(a,b,c){var d={user:a,ids:this.unit_ids,inst:this.inst,hf:this.hf,loc:this.loc,ex:this.ex};d=copy_properties(d,c);new AsyncRequest().setURI("/ajax/growth/pymk/megaphone/next.php").setData(d).setHandler(b).send();},_onAddFriendCallback:function(a,b){var c=b.getPayload();if(!c)return;var d=c.next,e=c.ex,f=this.ex&&e&&this._addExtra(e,true);d&&this._addNext(a,d,f);},_addExtra:function(a,b){this.ex=0;var c=DOM.appendContent($(this.root),a)[0];this._addRow(c);b&&CSS.hide(c);return c;},_fadeOut:function(a,b){var c=this.units[a],d=animation(c).from('opacity',1).to('opacity',0).duration(500);if(b)d=d.checkpoint(1,b);d.go();delete this.units[a];this.unit_ids.remove(a);}};